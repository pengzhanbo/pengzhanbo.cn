---
title: TypeScript ä¸­çš„åå˜ä¸é€†å˜
createTime: 2022/07/23 11:09:37
permalink: /article/e5tdk50d/
tags:
  - typescript
---

> æŒæ¡ç±»å‹ç³»ç»Ÿçš„æ ¸å¿ƒæ¦‚å¿µï¼Œè®©ä½ çš„ TypeScript æ°´å¹³æ›´ä¸Šä¸€å±‚æ¥¼

## å¼•è¨€ï¼šä¸ºä»€ä¹ˆéœ€è¦äº†è§£åå˜ä¸é€†å˜ï¼Ÿ

ä½œä¸º TypeScript å¼€å‘è€…ï¼Œä½ å¯èƒ½ç»å¸¸é‡åˆ°ä¸€äº›çœ‹ä¼¼"ä¸åˆç†"çš„ç±»å‹é”™è¯¯ã€‚æ¯”å¦‚ï¼Œä¸ºä»€ä¹ˆ `string[]` å¯ä»¥èµ‹å€¼ç»™ `(string | number)[]`ï¼Œä½† `(string | number)[]` å´ä¸èƒ½èµ‹å€¼ç»™ `string[]`ï¼Ÿè¿™èƒŒåå°±æ˜¯åå˜ä¸é€†å˜åœ¨èµ·ä½œç”¨ã€‚

ç†è§£è¿™ä¸¤ä¸ªæ¦‚å¿µä¸ä»…èƒ½å¸®ä½ è§£å†³æ—¥å¸¸å¼€å‘ä¸­çš„ç±»å‹å›°æƒ‘ï¼Œè¿˜èƒ½è®©ä½ å†™å‡ºæ›´å®‰å…¨ã€æ›´å¥å£®çš„ç±»å‹ä»£ç ã€‚

## æ ¸å¿ƒæ¦‚å¿µï¼šç”¨ç°å®ä¸–ç•Œç±»æ¯”ç†è§£

### ä»€ä¹ˆæ˜¯åå˜ï¼ˆCovarianceï¼‰ï¼Ÿ

**ç®€å•ç†è§£**ï¼šåå˜å°±æ˜¯"ä¿æŒæ–¹å‘ä¸€è‡´"ã€‚

**ç°å®ç±»æ¯”**ï¼š
æƒ³è±¡ä¸€ä¸ªå® ç‰©åº—ï¼š

- å¦‚æœä½ æ‰¿è¯º"æˆ‘ä¼šç…§é¡¾ä»»ä½•å“ç§çš„ç‹—"
- é‚£ä¹ˆä½ å½“ç„¶ä¹Ÿèƒ½"ç…§é¡¾é‡‘æ¯›çŠ¬"ï¼ˆå› ä¸ºé‡‘æ¯›æ˜¯ç‹—çš„å­ç±»å‹ï¼‰

åœ¨ç±»å‹ç³»ç»Ÿä¸­ï¼Œå¦‚æœ `é‡‘æ¯›çŠ¬` æ˜¯ `ç‹—` çš„å­ç±»å‹ï¼Œé‚£ä¹ˆ `ç…§é¡¾é‡‘æ¯›çŠ¬[]` ä¹Ÿæ˜¯ `ç…§é¡¾ç‹—[]` çš„å­ç±»å‹ã€‚

```typescript
// åŸºç¡€ç±»å‹
class Animal { name!: string }
class Dog extends Animal { bark() {} }
class Cat extends Animal { meow() {} }

// åå˜ç¤ºä¾‹ï¼šæ•°ç»„ç±»å‹
let dogs: Dog[] = [new Dog(), new Dog()]
let animals: Animal[] = dogs // âœ… å…è®¸ï¼šDog[] å¯ä»¥èµ‹å€¼ç»™ Animal[]

// å› ä¸ºï¼šDog extends Animal
// æ‰€ä»¥ï¼šDog[] ä¹Ÿ "extends" Animal[] ï¼ˆè¿™å°±æ˜¯åå˜ï¼‰
```

### ä»€ä¹ˆæ˜¯é€†å˜ï¼ˆContravarianceï¼‰ï¼Ÿ

**ç®€å•ç†è§£**ï¼šé€†å˜å°±æ˜¯"æ–¹å‘åè½¬"ã€‚

**ç°å®ç±»æ¯”**ï¼š
æƒ³è±¡ä¸€ä¸ªå® ç‰©é¢†å…»æ´»åŠ¨ï¼š

- å¦‚æœä½ æ‰¿è¯º"æˆ‘èƒ½å¤„ç†ä»»ä½•åŠ¨ç‰©ç›¸å…³çš„å·¥ä½œ"
- é‚£ä¹ˆä½ å…¶å®ä¹Ÿèƒ½"å¤„ç†ç‹—ç›¸å…³çš„å·¥ä½œ"ï¼ˆå› ä¸ºç‹—æ˜¯åŠ¨ç‰©çš„å­ç±»å‹ï¼‰

æ³¨æ„è¿™é‡Œçš„æ–¹å‘ï¼š`å¤„ç†åŠ¨ç‰©` æ˜¯ `å¤„ç†ç‹—` çš„å­ç±»å‹ï¼Œæ–¹å‘åäº†ï¼

```typescript
// å‡½æ•°å‚æ•°ç±»å‹çš„é€†å˜
type AnimalHandler = (animal: Animal) => void
type DogHandler = (dog: Dog) => void

let handleAnimal: AnimalHandler = (animal: Animal) => {
  console.log(animal.name)
}

let handleDog: DogHandler = handleAnimal // âœ… å…è®¸ï¼šAnimalHandler å¯ä»¥èµ‹å€¼ç»™ DogHandler

// ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºä»»ä½•éœ€è¦å¤„ç†ç‹—çš„å‡½æ•°ï¼Œæˆ‘ç»™å®ƒä¸€ä¸ªèƒ½å¤„ç†æ‰€æœ‰åŠ¨ç‰©çš„å‡½æ•°ï¼Œç»å¯¹å®‰å…¨ï¼
```

## TypeScript ä¸­çš„åå˜ä¸é€†å˜å®è·µ

### 1. æ•°ç»„å’Œå¯¹è±¡æ˜¯åå˜çš„

è¿™æ˜¯æœ€å¸¸è§çš„åå˜åœºæ™¯ï¼š

```typescript
// æ•°ç»„åå˜
let stringArray: string[] = ['hello', 'world']
let stringOrNumberArray: (string | number)[] = stringArray // âœ… å…è®¸

// å¯¹è±¡å±æ€§åå˜
interface Base {
  pet: Animal
}

interface Derived {
  pet: Dog // Dog æ˜¯ Animal çš„å­ç±»å‹
}

let derived: Derived = { pet: new Dog() }
let base: Base = derived // âœ… å…è®¸
```

### 2. å‡½æ•°å‚æ•°æ˜¯é€†å˜çš„

è¿™æ˜¯ TypeScript ä¸­æœ€é‡è¦çš„é€†å˜åœºæ™¯ï¼š

```typescript
// å‡½æ•°ç±»å‹æ¯”è¾ƒ
type ProcessAnimal = (animal: Animal) => void
type ProcessDog = (dog: Dog) => void

// è¿™æ˜¯å®‰å…¨çš„ï¼šèƒ½å¤„ç†æ‰€æœ‰åŠ¨ç‰©çš„äººï¼Œè‚¯å®šèƒ½å¤„ç†ç‹—
let processDog: ProcessDog = (dog: Dog) => { /* åªå¤„ç†ç‹— */ }
let processAnimal: ProcessAnimal = processDog // âŒ é”™è¯¯ï¼ä¸ºä»€ä¹ˆï¼Ÿ

// ç­‰ç­‰ï¼Œè¿™é‡Œä¸ºä»€ä¹ˆæŠ¥é”™ï¼Ÿ
```

å®é™…ä¸Šï¼Œåœ¨ TypeScript çš„ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œå‡½æ•°å‚æ•°æ˜¯é€†å˜çš„ï¼š

```typescript
// æ­£ç¡®çš„é€†å˜ç¤ºä¾‹
let processAnimal: ProcessAnimal = (animal: Animal) => {
  console.log(animal.name)
}

let processDog: ProcessDog = processAnimal // âœ… å…è®¸ï¼

// ç†è§£ï¼šä»»ä½•éœ€è¦å¤„ç†ç‹—çš„åœ°æ–¹ï¼Œæˆ‘ç»™å®ƒä¸€ä¸ªèƒ½å¤„ç†æ‰€æœ‰åŠ¨ç‰©çš„å‡½æ•°ï¼Œç»å¯¹å®‰å…¨
// å› ä¸º processAnimal èƒ½å¤„ç† Animalï¼Œå½“ç„¶ä¹Ÿèƒ½å¤„ç† Dogï¼ˆDog æ˜¯ Animal çš„å­ç±»å‹ï¼‰
```

### 3. å‡½æ•°è¿”å›å€¼æ˜¯åå˜çš„

```typescript
type GetAnimal = () => Animal
type GetDog = () => Dog

let getDog: GetDog = () => new Dog()
let getAnimal: GetAnimal = getDog // âœ… å…è®¸

// ç†è§£ï¼šä»»ä½•éœ€è¦è¿”å›åŠ¨ç‰©çš„åœ°æ–¹ï¼Œæˆ‘ç»™å®ƒä¸€ä¸ªè¿”å›ç‹—çš„å‡½æ•°ï¼Œå®Œå…¨æ²¡é—®é¢˜
// å› ä¸ºç‹—å°±æ˜¯åŠ¨ç‰©ï¼ˆDog extends Animalï¼‰
```

## å®é™…åº”ç”¨åœºæ™¯

### åœºæ™¯ 1ï¼šäº‹ä»¶å¤„ç†å‡½æ•°

```typescript
// React äº‹ä»¶å¤„ç†å™¨çš„ç±»å‹å®‰å…¨
interface BaseEvent {
  preventDefault: () => void
}

interface MouseEvent extends BaseEvent {
  clientX: number
  clientY: number
}

// å¤„ç†åŸºç¡€äº‹ä»¶çš„å‡½æ•°
function handleBaseEvent(event: BaseEvent) {
  event.preventDefault()
}

// å¤„ç†é¼ æ ‡äº‹ä»¶çš„å‡½æ•°
function handleMouseEvent(event: MouseEvent) {
  console.log(`Click at: ${event.clientX}, ${event.clientY}`)
  event.preventDefault()
}

// åœ¨éœ€è¦ MouseEventHandler çš„åœ°æ–¹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ›´é€šç”¨çš„ BaseEventHandler
let mouseHandler: (event: MouseEvent) => void = handleBaseEvent // âœ… å®‰å…¨ï¼

// åè¿‡æ¥å°±ä¸å®‰å…¨ï¼š
// let baseHandler: (event: BaseEvent) => void = handleMouseEvent; // âŒ å±é™©ï¼
```

### åœºæ™¯ 2ï¼šå›è°ƒå‡½æ•°ç±»å‹å®‰å…¨

```typescript
// æ•°æ®å¤„ç†å™¨
type DataProcessor<T> = (data: T) => void

// å…·ä½“çš„å¤„ç†å™¨
const stringProcessor: DataProcessor<string> = (str) => {
  console.log(str.toUpperCase())
}

const anyProcessor: DataProcessor<any> = (data) => {
  console.log(data)
}

// é€†å˜çš„åº”ç”¨ï¼šæ›´é€šç”¨çš„å¤„ç†å™¨å¯ä»¥èµ‹å€¼ç»™æ›´å…·ä½“çš„å¤„ç†å™¨
let processString: DataProcessor<string> = anyProcessor // âœ… å®‰å…¨

// åå˜çš„åº”ç”¨ï¼ˆåœ¨è¿”å›å€¼ä¸­ï¼‰
type DataFactory<T> = () => T

const stringFactory: DataFactory<string> = () => 'hello'
const anyFactory: DataFactory<any> = stringFactory // âœ… å®‰å…¨
```

### åœºæ™¯ 3ï¼šæ³›å‹çº¦æŸ

```typescript
// åå˜åœ¨ Promise ä¸­çš„åº”ç”¨
async function getDog(): Promise<Dog> {
  return new Dog()
}

// å¯ä»¥èµ‹å€¼ç»™è¿”å›æ›´é€šç”¨ç±»å‹çš„å‡½æ•°
async function getAnimal(): Promise<Animal> {
  return getDog() // âœ… Promise<Dog> å¯ä»¥èµ‹å€¼ç»™ Promise<Animal>
}

// é€†å˜åœ¨å‡½æ•°å‚æ•°ä¸­çš„åº”ç”¨
function processAnimal(processor: (animal: Animal) => void) {
  processor(new Animal())
}

function processDog(processor: (dog: Dog) => void) {
  processor(new Dog())
}

// å¯ä»¥æ¥å—æ›´é€šç”¨çš„å¤„ç†å™¨
processDog((animal: Animal) => console.log(animal.name)) // âœ… å®‰å…¨
```

## è®°å¿†æŠ€å·§ä¸ç†è§£è¦ç‚¹

### åå˜è®°å¿†å£è¯€
>
> "å­ç±»å‹å¯ä»¥æ›¿ä»£çˆ¶ç±»å‹"
> æ•°ç»„ã€Promiseã€è¿”å›å€¼éƒ½éµå¾ªè¿™ä¸ªè§„åˆ™

### é€†å˜è®°å¿†å£è¯€
>
> "å¤„ç†çˆ¶ç±»å‹çš„å‡½æ•°å¯ä»¥æ›¿ä»£å¤„ç†å­ç±»å‹çš„å‡½æ•°"
> å‡½æ•°å‚æ•°éµå¾ªè¿™ä¸ªè§„åˆ™

### å®‰å…¨åŸåˆ™

å§‹ç»ˆè€ƒè™‘**ç±»å‹å®‰å…¨**ã€‚TypeScript çš„æ‰€æœ‰ç±»å‹è§„åˆ™éƒ½æ˜¯ä¸ºäº†ç¡®ä¿è¿è¡Œæ—¶ä¸ä¼šå‡ºç°ç±»å‹é”™è¯¯ã€‚

```typescript
// ä¸ºä»€ä¹ˆè¿™ä¸ªä¸å®‰å…¨ï¼Ÿæ€è€ƒä¸€ä¸‹ï¼š
let animalArray: Animal[] = [new Animal(), new Animal()]
let dogArray: Dog[] = animalArray // âŒ é”™è¯¯ï¼

// å¦‚æœå…è®¸ï¼Œå°±ä¼šå‡ºç°è¿™æ ·çš„è¿è¡Œæ—¶é”™è¯¯ï¼š
dogArray[0].bark() // ğŸ’¥ è¿è¡Œæ—¶é”™è¯¯ï¼animal æ²¡æœ‰ bark æ–¹æ³•
```

## æ€»ç»“

- **åå˜**ï¼šå­ç±»å‹å…³ç³»ä¿æŒä¸å˜ï¼ˆ`Dog[]` æ˜¯ `Animal[]` çš„å­ç±»å‹ï¼‰
- **é€†å˜**ï¼šå­ç±»å‹å…³ç³»åè½¬ï¼ˆ`(Animal) => void` æ˜¯ `(Dog) => void` çš„å­ç±»å‹ï¼‰
- **åº”ç”¨**ï¼š
  - æ•°ç»„ã€å¯¹è±¡å±æ€§ã€Promiseã€å‡½æ•°è¿”å›å€¼ï¼šåå˜
  - å‡½æ•°å‚æ•°ï¼šé€†å˜
- **æ ¸å¿ƒæ€æƒ³**ï¼šæ‰€æœ‰è§„åˆ™éƒ½æ˜¯ä¸ºäº†ç±»å‹å®‰å…¨ï¼Œé˜²æ­¢è¿è¡Œæ—¶é”™è¯¯

ç†è§£äº†åå˜å’Œé€†å˜ï¼Œä½ å°±èƒ½çœŸæ­£æŒæ¡ TypeScript ç±»å‹ç³»ç»Ÿçš„è®¾è®¡å“²å­¦ï¼Œå†™å‡ºæ›´åŠ ç±»å‹å®‰å…¨çš„ä»£ç ï¼

## å‚è€ƒ

- [TypeScript å®˜æ–¹æ–‡æ¡£ï¼šç±»å‹å…¼å®¹æ€§](https://www.typescriptlang.org/docs/handbook/type-compatibility.html){.read-more}
