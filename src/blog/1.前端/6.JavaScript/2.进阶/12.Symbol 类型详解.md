---
title: JavaScript è¿›é˜¶ åäºŒï¼š Symbol ç±»å‹è¯¦è§£
createTime: 2020/02/12 15:33:58
permalink: /article/d5z98qs5/
tags:
  - javascript
---

åœ¨ JavaScript çš„å‘å±•å†ç¨‹ä¸­ï¼ŒES6 å¼•å…¥äº†ä¸€ä¸ªé©å‘½æ€§çš„æ–°ç‰¹æ€§â€”â€”**Symbol**ã€‚ä½œä¸º JavaScript çš„ç¬¬ä¸ƒç§åŸå§‹æ•°æ®ç±»å‹ï¼ŒSymbol ä¸ºå¼€å‘è€…æä¾›äº†åˆ›å»ºå”¯ä¸€æ ‡è¯†ç¬¦çš„èƒ½åŠ›ï¼Œä»æ ¹æœ¬ä¸Šè§£å†³äº†å±æ€§åå†²çªçš„é—®é¢˜ã€‚

## ä»€ä¹ˆæ˜¯ Symbolï¼Ÿ

Symbol æ˜¯ä¸€ç§æ–°çš„**åŸå§‹æ•°æ®ç±»å‹**ï¼ˆprimitive typeï¼‰ï¼Œä¸ `string`ã€`number`ã€`boolean` ç­‰å¹¶åˆ—ã€‚å®ƒçš„æ ¸å¿ƒç‰¹æ€§æ˜¯**å”¯ä¸€æ€§**â€”â€”æ¯ä¸ª Symbol å€¼éƒ½æ˜¯ç‹¬ä¸€æ— äºŒçš„ã€‚

```javascript
// åˆ›å»º Symbol
const symbol1 = Symbol('')
const symbol2 = Symbol('')

console.log(symbol1 === symbol2) // false
console.log(typeof symbol1) // 'symbol'
```

:::tip å…³é”®ç‰¹æ€§

- æ¯ä¸ª Symbol éƒ½æ˜¯å”¯ä¸€çš„ï¼Œå³ä½¿æè¿°ç›¸åŒ
- ä¸å¯å˜æ€§ï¼šä¸€æ—¦åˆ›å»ºå°±ä¸èƒ½ä¿®æ”¹
- åŸå§‹ç±»å‹ï¼š`typeof` è¿”å› `'symbol'`
:::

## Symbol çš„åŸºæœ¬ç”¨æ³•

### åˆ›å»º Symbol

```javascript
// æ— æè¿°åˆ›å»º
// eslint-disable-next-line symbol-description
const sym1 = Symbol()

// å¸¦æè¿°åˆ›å»ºï¼ˆä»…ç”¨äºè°ƒè¯•ï¼‰
const sym2 = Symbol('description')
const sym3 = Symbol('description')

console.log(sym2 === sym3) // false - å³ä½¿æè¿°ç›¸åŒï¼Œå€¼ä¹Ÿä¸åŒ
```

### æè¿°ä¿¡æ¯çš„è·å–

```javascript
const sym = Symbol('ç”¨æˆ·ID')
console.log(sym.description) // 'ç”¨æˆ·ID' (ES2019+)
console.log(sym.toString()) // 'Symbol(ç”¨æˆ·ID)'
```

## Symbol çš„æ ¸å¿ƒåº”ç”¨åœºæ™¯

### 1. ä½œä¸ºå¯¹è±¡å±æ€§é”®

Symbol çš„ä¸»è¦ä»·å€¼åœ¨äºä½œä¸ºå¯¹è±¡çš„å±æ€§åï¼Œå½»åº•é¿å…å‘½åå†²çªã€‚

```javascript
const USER_ID = Symbol('user_id')
const USER_NAME = Symbol('user_name')

const user = {
  [USER_ID]: '12345',
  [USER_NAME]: 'å¼ ä¸‰',
  age: 25
}

console.log(user[USER_ID]) // '12345'
console.log(user[USER_NAME]) // 'å¼ ä¸‰'
```

:::warning é‡è¦ç‰¹æ€§
Symbol å±æ€§åœ¨å¸¸è§„éå†ä¸­**ä¸å¯è§**ï¼š

```javascript
const obj = {
  [Symbol('hidden')]: 'éšè—å±æ€§',
  visible: 'å¯è§å±æ€§'
}

console.log(Object.keys(obj)) // ['visible']
console.log(Object.getOwnPropertyNames(obj)) // ['visible']

for (let key in obj) {
  console.log(key) // åªè¾“å‡º 'visible'
}
```

:::

### 2. è·å– Symbol å±æ€§

è™½ç„¶ Symbol å±æ€§åœ¨å¸¸è§„éå†ä¸­ä¸å¯è§ï¼Œä½†å¯ä»¥é€šè¿‡ä¸“é—¨çš„æ–¹æ³•è®¿é—®ï¼š

```javascript
const obj = {
  [Symbol('secret')]: 'æœºå¯†æ•°æ®',
  public: 'å…¬å¼€æ•°æ®'
}

// è·å–æ‰€æœ‰ Symbol å±æ€§
const symbols = Object.getOwnPropertySymbols(obj)
console.log(symbols) // [Symbol(secret)]
console.log(obj[symbols[0]]) // 'æœºå¯†æ•°æ®'

// è·å–æ‰€æœ‰é”®ï¼ˆåŒ…æ‹¬ Symbolï¼‰
const allKeys = Reflect.ownKeys(obj)
console.log(allKeys) // ['public', Symbol(secret)]
```

### 3. æ›¿ä»£å¸¸é‡å®šä¹‰

ä¼ ç»Ÿå­—ç¬¦ä¸²å¸¸é‡å®¹æ˜“å› æ‹¼å†™é”™è¯¯å¯¼è‡´ bugï¼Œè€Œ Symbol ä»æ ¹æœ¬ä¸Šè§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚

:::code-tabs
@tab ä¼ ç»Ÿæ–¹å¼ï¼ˆæ˜“å‡ºé”™ï¼‰

```javascript
const STATUS = {
  PENDING: 'pending',
  SUCCESS: 'succes' // æ‹¼å†™é”™è¯¯ï¼
}

function handleStatus(status) {
  if (status === STATUS.SUCCES) { // è¿™é‡Œä¹Ÿæ‹¼å†™é”™è¯¯
    // æ°¸è¿œä¸ä¼šæ‰§è¡Œ
  }
}
```

@tab Symbol æ–¹å¼ï¼ˆå®‰å…¨ï¼‰

```javascript
const STATUS = {
  PENDING: Symbol('pending'),
  SUCCESS: Symbol('success'),
  ERROR: Symbol('error')
}

function handleStatus(status) {
  if (status === STATUS.SUCCESS) { // å¼•ç”¨æ­£ç¡®ï¼Œä¸ä¼šå‡ºé”™
    console.log('æ“ä½œæˆåŠŸ')
  }
}
```

:::

### 4. æ¨¡æ‹Ÿç§æœ‰å±æ€§

åœ¨ ES6 å¼•å…¥çœŸæ­£çš„ç§æœ‰å­—æ®µä¹‹å‰ï¼ŒSymbol æ˜¯æ¨¡æ‹Ÿç§æœ‰å±æ€§çš„æœ€ä½³æ–¹æ¡ˆã€‚

```javascript title="user.js"
const PASSWORD = Symbol('password')

class User {
  constructor(username, password) {
    this.username = username
    this[PASSWORD] = password
  }

  checkPassword(inputPassword) {
    return this[PASSWORD] === inputPassword
  }
}

export default User
```

```javascript title="main.js"
import User from './user.js'

const user = new User('admin', '123456')

console.log(user.checkPassword('123456')) // true
console.log(user.PASSWORD) // undefined
console.log(user[Symbol('password')]) // undefined - æ— æ³•è®¿é—®
```

## å…¨å±€ Symbol æ³¨å†Œè¡¨

å¦‚æœéœ€è¦åœ¨ä¸åŒåœ°æ–¹å…±äº«åŒä¸€ä¸ª Symbolï¼Œå¯ä»¥ä½¿ç”¨å…¨å±€æ³¨å†Œè¡¨ã€‚

### Symbol.for() å’Œ Symbol.keyFor()

```javascript
// åˆ›å»ºæˆ–è·å–å…¨å±€ Symbol
const globalSym1 = Symbol.for('app.config')
const globalSym2 = Symbol.for('app.config')

console.log(globalSym1 === globalSym2) // true

// è·å–å…¨å±€ Symbol çš„æè¿°
console.log(Symbol.keyFor(globalSym1)) // 'app.config'

// éå…¨å±€ Symbol è¿”å› undefined
const localSym = Symbol('local')
console.log(Symbol.keyFor(localSym)) // undefined
```

:::info ä½¿ç”¨åœºæ™¯
å…¨å±€ Symbol é€‚åˆåœ¨å¤šä¸ªæ¨¡å—é—´å…±äº«é…ç½®ã€çŠ¶æ€æˆ–æ ‡è¯†ç¬¦ï¼Œç¡®ä¿ä½¿ç”¨åŒä¸€ä¸ª Symbol å®ä¾‹ã€‚
:::

## å†…ç½® Symbol å€¼ï¼ˆWell-known Symbolsï¼‰

ES6 æä¾›äº†ä¸€ç³»åˆ—å†…ç½® Symbolï¼Œç”¨äºå®šåˆ¶å¯¹è±¡çš„å†…éƒ¨è¡Œä¸ºã€‚

### Symbol.iterator - å®šä¹‰è¿­ä»£å™¨

```javascript
class Range {
  constructor(start, end) {
    this.start = start
    this.end = end
  }

  [Symbol.iterator]() {
    let current = this.start
    const end = this.end

    return {
      next() {
        if (current <= end) {
          return { value: current++, done: false }
        }
        return { done: true }
      }
    }
  }
}

const range = new Range(1, 3)
for (const num of range) {
  console.log(num) // 1, 2, 3
}
```

### Symbol.toStringTag - è‡ªå®šä¹‰ç±»å‹æ ‡ç­¾

```javascript
class Collection {
  constructor() {
    this.items = []
  }

  get [Symbol.toStringTag]() {
    return 'CustomCollection'
  }
}

const coll = new Collection()
console.log(Object.prototype.toString.call(coll)) // '[object CustomCollection]'
```

### Symbol.toPrimitive - ç±»å‹è½¬æ¢æ§åˆ¶

```javascript
const temperature = {
  value: 25,
  unit: 'Â°C',

  [Symbol.toPrimitive](hint) {
    switch (hint) {
      case 'string':
        return `${this.value}${this.unit}`
      case 'number':
        return this.value
      default:
        return this.value.toString()
    }
  }
}

console.log(String(temperature)) // "25Â°C"
console.log(Number(temperature)) // 25
console.log(temperature + 5) // 30
```

### å…¶ä»–é‡è¦å†…ç½® Symbol

- **Symbol.hasInstance**: è‡ªå®šä¹‰ `instanceof` è¡Œä¸º
- **Symbol.isConcatSpreadable**: æ§åˆ¶æ•°ç»„è¿æ¥æ—¶çš„å±•å¼€è¡Œä¸º
- **Symbol.species**: æŒ‡å®šæ´¾ç”Ÿå¯¹è±¡çš„æ„é€ å‡½æ•°
- **Symbol.match/replace/search/split**: è‡ªå®šä¹‰å­—ç¬¦ä¸²åŒ¹é…è¡Œä¸º

## Symbol ä¸ JSON

:::caution æ³¨æ„
Symbol å±æ€§åœ¨ JSON åºåˆ—åŒ–æ—¶ä¼šè¢«å®Œå…¨å¿½ç•¥ï¼š

```javascript
const obj = {
  name: 'Alice',
  [Symbol('id')]: 123
}

console.log(JSON.stringify(obj)) // '{"name":"Alice"}'
```

:::

## å®é™…å¼€å‘ä¸­çš„æœ€ä½³å®è·µ

### 1. åº“å¼€å‘ä¸­çš„å±æ€§æ‰©å±•

```javascript
// å®‰å…¨åœ°ä¸ºå†…ç½®å¯¹è±¡æ·»åŠ æ‰©å±•
const CUSTOM_FILTER = Symbol('customFilter')

// eslint-disable-next-line no-extend-native
Array.prototype[CUSTOM_FILTER] = function (predicate) {
  const result = []
  for (let i = 0; i < this.length; i++) {
    if (predicate(this[i], i, this)) {
      result.push(this[i])
    }
  }
  return result
}

const numbers = [1, 2, 3, 4, 5]
const evens = numbers[CUSTOM_FILTER](n => n % 2 === 0)
console.log(evens) // [2, 4]
```

### 2. å…ƒæ•°æ®å­˜å‚¨

```javascript
const METADATA = Symbol('metadata')

class ApiClient {
  constructor(baseURL) {
    this.baseURL = baseURL
    this[METADATA] = {
      requestCount: 0,
      lastRequest: null
    }
  }

  async get(url) {
    this[METADATA].requestCount++
    this[METADATA].lastRequest = new Date()

    // å®é™…çš„è¯·æ±‚é€»è¾‘...
    console.log(`è¯·æ±‚ ${this.baseURL}${url}`)
  }

  getStats() {
    return { ...this[METADATA] }
  }
}

const client = new ApiClient('https://api.example.com')
await client.get('/users')
console.log(client.getStats()) // { requestCount: 1, lastRequest: ... }
```

### 3. äº‹ä»¶ç³»ç»Ÿ

```javascript
const EVENT_TYPES = {
  CLICK: Symbol('click'),
  HOVER: Symbol('hover'),
  FOCUS: Symbol('focus')
}

class EventEmitter {
  constructor() {
    this.listeners = new Map()
  }

  on(eventType, handler) {
    if (!this.listeners.has(eventType)) {
      this.listeners.set(eventType, new Set())
    }
    this.listeners.get(eventType).add(handler)
  }

  emit(eventType, data) {
    const handlers = this.listeners.get(eventType)
    if (handlers) {
      handlers.forEach(handler => handler(data))
    }
  }
}

const emitter = new EventEmitter()
emitter.on(EVENT_TYPES.CLICK, (data) => {
  console.log('ç‚¹å‡»äº‹ä»¶:', data)
})

emitter.emit(EVENT_TYPES.CLICK, { x: 100, y: 200 })
```

## æ³¨æ„äº‹é¡¹å’Œé™åˆ¶

:::important é‡è¦æé†’

1. **ç±»å‹è½¬æ¢é™åˆ¶**: Symbol ä¸èƒ½éšå¼è½¬æ¢ä¸ºå­—ç¬¦ä¸²æˆ–æ•°å­—

   ```javascript
   const sym = Symbol('test')
   // console.log('Symbol: ' + sym); // TypeError!
   console.log(String(sym)) // æ­£ç¡®æ–¹å¼
   ```

2. **ä¸æ˜¯çœŸæ­£çš„ç§æœ‰**: é€šè¿‡ `Object.getOwnPropertySymbols()` ä»ç„¶å¯ä»¥è®¿é—®

3. **æ¨¡å—ä¾èµ–**: æ¨¡æ‹Ÿç§æœ‰å±æ€§æ—¶ï¼ŒSymbol å¿…é¡»åœ¨åŒä¸€æ¨¡å—ä¸­å®šä¹‰
:::

## æ€»ç»“

Symbol ä½œä¸º ES6 å¼•å…¥çš„é‡è¦ç‰¹æ€§ï¼Œä¸º JavaScript å¸¦æ¥äº†ï¼š

- **ğŸ¯ å”¯ä¸€æ€§ä¿éšœ**: ä»æ ¹æœ¬ä¸Šè§£å†³å±æ€§åå†²çª
- **ğŸ”’ åŠç§æœ‰å±æ€§**: æä¾›æ¯”å­—ç¬¦ä¸²é”®æ›´éšè”½çš„å±æ€§å®šä¹‰
- **âš™ï¸ å…ƒç¼–ç¨‹èƒ½åŠ›**: é€šè¿‡å†…ç½® Symbol å®šåˆ¶å¯¹è±¡è¡Œä¸º
- **ğŸ”„ è·¨æ¨¡å—å…±äº«**: å…¨å±€ Symbol æ³¨å†Œè¡¨æ”¯æŒ

åœ¨å®é™…å¼€å‘ä¸­ï¼ŒSymbol ç‰¹åˆ«é€‚åˆï¼š

- åº“å’Œæ¡†æ¶å¼€å‘
- éœ€è¦é¿å…å±æ€§å†²çªçš„åœºæ™¯
- å®šä¹‰å†…éƒ¨å…ƒæ•°æ®
- å®ç°è‡ªå®šä¹‰è¿­ä»£å™¨å’Œç±»å‹è½¬æ¢

è™½ç„¶ ES2022 å¼•å…¥äº†çœŸæ­£çš„ç§æœ‰å­—æ®µï¼ˆ`#` è¯­æ³•ï¼‰ï¼Œä½† Symbol åœ¨é¿å…å‘½åå†²çªå’Œå…ƒç¼–ç¨‹æ–¹é¢ä»ç„¶å…·æœ‰ä¸å¯æ›¿ä»£çš„ä»·å€¼ã€‚

==æŒæ¡ Symbol æ˜¯æ·±å…¥ç†è§£ç°ä»£ JavaScript çš„å…³é”®ä¸€æ­¥=={.success}ï¼Œå®ƒä¸ºæˆ‘ä»¬æä¾›äº†æ›´å®‰å…¨ã€æ›´çµæ´»çš„ç¼–ç¨‹æ¨¡å¼ã€‚
